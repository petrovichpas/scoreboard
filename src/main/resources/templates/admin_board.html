<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="utf-8"/>
    <title>Board</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
<!--    <script th:src="@{/js/main.js}"></script>-->
</head>

<body>
    <div th:insert="fragments/menu :: menu"></div>

<!--    <form th:action="@{/hockey/plus}" method="POST">-->
        <input id="id" name="id" th:value="${board.id}" type="hidden" class="form-control">
        <table class="table table-hover" >
            <tbody>
                <tr>
                    <td>
                        <input th:value="${board.homeName}" name="homeName" type="text" class="form-control" onchange="changeField(value, name)">
                    </td>
                    <td>
                        <button value="minutesMinus" type="button" class="btn btn-primary" onclick="plusOrMinusOne(value)">-</button>
                        <button value="minutesPlus" type="button" class="btn btn-primary" onclick="plusOrMinusOne(value)">+</button>
                        <label id="time" th:text="${#numbers.formatInteger(board.currentTime/60, 2) + ':' + #numbers.formatInteger(board.currentTime%60, 2)}"/>
                        <button value="secondsMinus" type="button" class="btn btn-primary" onclick="plusOrMinusOne(value)">-</button>
                        <button value="secondsPlus" type="button" class="btn btn-primary" onclick="plusOrMinusOne(value)">+</button>
                    </td>
                    <td>
                        <input th:value="${board.awayName}" name="awayName" type="text" class="form-control" onchange="changeField(value, name)">
                    </td>
                </tr>

                <tr>
                    <td>
                        <button value="homeScoreMinus" type="button" class="btn btn-primary" onclick="plusOrMinusOne(value)">-</button>
                        <label id="homeScore" th:text="${board.homeScore}"/>
                        <button value="homeScorePlus" type="button" class="btn btn-primary" onclick="plusOrMinusOne(value)">+</button>
                    </td>
                    <td>
                        <button value="periodMinus" type="button" class="btn btn-primary" onclick="plusOrMinusOne(value)">-</button>
                        <label id="period" th:text=" ((${board.period} > 0) ? ${board.period} : 'OT')"/>
                        <button value="periodPlus" type="button" class="btn btn-primary" onclick="plusOrMinusOne(value)">+</button>
                    </td>
                    <td>
                        <button value="awayScoreMinus" type="button" class="btn btn-primary" onclick="plusOrMinusOne(value)">-</button>
                        <label id="awayScore" th:text="${board.awayScore}"/>
                        <button value="awayScorePlus" type="button" class="btn btn-primary" onclick="plusOrMinusOne(value)">+</button>
                    </td>
                </tr>
            </tbody>
        </table>


<!--        <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">-->
<!--        <label class="form-check-label" for="defaultCheck1">-->
<!--            Default checkbox-->
<!--        </label>-->
<!--    </form>-->

<!--    <form th:action="@{/hockey/start}" method="POST">-->
<!--        <input id="id" th:value="${board.id}" name="id" type="hidden" class="form-control">-->
        <button id="startStop" type="button" class="btn btn-danger" th:text="${startStop}" onclick="getStartStop(document.getElementById('id').value)"/>
<!--    </form>-->




    <div class="accordion" id="accordionExample">
        <div class="card">
            <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                Advanced settings
            </button>

            <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionExample">
                <div class="card-body">
                    <div>
                        <label for="countdownMode">Countdown Mode</label>
                        <input id="countdownMode" type="checkbox" name="isCountdownModeSelected" th:checked="${isCountdownModeSelected}" onclick="changeMode()"/>
                    </div>
                    <div>
                        <label for="maxTime">Maximum period time</label>
                        <input id="maxTime" th:value="${board.maxTime / 60}" name="maxTime" type="number" class="form-control" onchange="changeField(value, name)">
                    </div>
                </div>
            </div>
        </div>
    </div>




    <script>
        function getStartStop(id){
            $.ajax({
                type: "POST",
                url: "/hockey/start",
                data: {id: id},
                success: result => {
                    $("#startStop").text(result)
                }
            });
        };

        function plusOrMinusOne(param){
            $.ajax({
                type: "POST",
                url: "/hockey/plus-minus",
                data: {action: param, id: document.getElementById('id').value},
                success: result => {
                    if (param == "minutesPlus" || param == "minutesMinus" || param == "secondsPlus" || param == "secondsMinus"){
                        $("#time").text(String(~~(result / 60)).padStart(2, '0') + ':' + String(~~(result % 60)).padStart(2, '0'));
                    } else if (param == "homeScorePlus" || param == "homeScoreMinus"){
                        $("#homeScore").text(result);
                    } else if (param == "periodPlus" || param == "periodMinus"){
                        $('#period').text(result);
                    } else if (param == "awayScorePlus" || param == "awayScoreMinus"){
                        $("#awayScore").text(result);
                    }
                }
            });
        };

        function changeMode(){
            $.ajax({
                type: "POST",
                url: "/hockey/mode",
                data: {id: document.getElementById('id').value},
            });
        };

        function changeField(val, name){
            $.ajax({
                type: "POST",
                url: "/hockey/name",
                data: {value: val, name: name, id: document.getElementById('id').value},
            });
        };

        function time() {
            $.ajax({
                type: "GET",
                url: "/hockey/time",
                data: {id: document.getElementById('id').value},
                success: result => {
                    $("#homeScore").text(result[0])
                    $("#time").text(String(~~(result[1] / 60)).padStart(2, '0') + ':' + String(result[1] % 60).padStart(2, '0'))
                    $("#awayScore").text(result[2])
                    if (result[3] > 0) $("#period").text(result[3]);
                    else $("#period").text('OT');
                }
            });
        }

        setInterval(time,1000);
    </script>
</body>
</html>
